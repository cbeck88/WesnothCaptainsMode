#define ALL_CREEP 
Drake Burner,Drake Clasher,Drake Fighter,Drake Glider,Dwarvish Fighter,Dwarvish Guardsman,Dwarvish Scout,Dwarvish Thunderer,Gryphon Rider,Elvish Archer,Elvish Fighter,Elvish Scout,Elvish Shaman,Wolf Rider,Thief,Thug,Footpad,Poacher,Dark Adept,Sergeant,Spearman,Bowman,Horseman,Cavalryman,Fencer,Heavy Infantryman,Mage,Saurian Augur,Saurian Skirmisher,Merman Fighter,Mermaid Initiate,Merman Fighter,Merman Hunter,Naga Fighter,Orcish Grunt,Orcish Leader,Orcish Archer,Orcish Assassin,Ghoul,Skeleton,Skeleton Archer
#enddef

#Modify these lines to change the schedule of picks / bans and what hexes are associated to each choice.
#Best to set so that p2 picks last, so that p1 gets to pick map.
#define CREEP_6_SCHEDULE_Player
    1,2,3,5,  1,2,3,5,  6,7,6,7
#enddef
#define CREEP_6_SCHEDULE_isBan
    yes,yes,yes,yes,no,no,no,no,yes,yes,no,no
#enddef
#define CREEP_6_SCHEDULE_X
    10,22,12,24, 10,22,12,24, 14, 26, 14, 26 
#enddef
#define CREEP_6_SCHEDULE_Y
    8,8,8,8,   2,2,2,2,   8,8,2,2
#enddef
#define CREEP_6_STRINGS
Ban Phase, Pick Phase, Final Ban, Final Pick
#enddef

#define W_GUARD_X
    12
#enddef
#define W_GUARD_Y
    5
#enddef
#define W_GUARD_TEAM
    8
#enddef
#define E_GUARD_X
    24
#enddef
#define E_GUARD_Y
    5
#enddef
#define E_GUARD_TEAM
    4
#enddef


#Modify these lines to change where and in what colors the schedule listing appears
#define LIST_LOC_X
    17
#enddef
#define LIST_LOC_Y
    4
#enddef
#define LIST_COLOR
    128,128,255
#enddef
#define LIST_COLOR_HIGHLIGHTED
    255,0,0
#enddef

#define CREEP_PRESTART SCHEDULE_Player SCHEDULE_isBan SCHEDULE_X SCHEDULE_Y PHASE_STRINGS
    #Overlay the draft mode map
    [terrain_mask]
        x = 1
        y = 1
        mask = "{~add-ons/Captains_Mode/resources/6p_Creep_War_Draft_Mode.map}"
    [/terrain_mask]

    #Set fog and shroud to zero and gold appropriately if user didn't use default settings.
    [modify_side]
        side=1,2,3,4,5,6,7,8
        shroud=no
        fog=no
        gold=100
        income=20
    [/modify_side]

    #Test if era looks not correct...
    [store_side]
        variable=side1
        side=1
    [/store_side]
    [store_side]
        variable=side2
        side=2
    [/store_side]
    [set_variables]
        name=side1_rec_arr
        [split]
            list=$side1.recruit
            key=val
            separator=,
        [/split]
    [/set_variables]
    [set_variables]
        name=side2_rec_arr
        [split]
            list=$side2.recruit
            key=val
            separator=,
        [/split]
    [/set_variables]

    [if]
        {VARIABLE_CONDITIONAL side1_rec_arr.length less_than 12}
        [or]
            {VARIABLE_CONDITIONAL side2_rec_arr.length less_than 12}
            [or]
                {VARIABLE_CONDITIONAL side1_rec_arr.length not_equals $side2_rec_arr.length}
            [/or]
        [/or]
        [then]
            [set_recruit]
                side=1,2,3,4,5,6,7,8
                recruit={ALL_CREEP}
            [/set_recruit]
        [/then]
    [/if]

    {CLEAR_VARIABLE (side1, side2, side1_rec_arr, side2_rec_arr)}

    {VARIABLE PICK_CTR 0}
    {VARIABLE numpicked1 0}
    {VARIABLE numpicked2 0}
    {VARIABLE numpicked3 0}
    {VARIABLE numpicked5 0}
    {VARIABLE numpicked6 0}
    {VARIABLE numpicked7 0}

    [set_variables]
        name = TEAM_W
        [split]
            list = "no, yes,no,yes,no,yes,no,yes,no"
            key = val
            separator = ,
            remove_empty = no
        [/split]
    [/set_variables]

    {VARIABLE next_scen ""}

    #{SCHEDULE_INIT}
    [set_variables]
        name = SCHED_X
        [split]
            list = {{SCHEDULE_X}}
            key = val
            separator = ,
            remove_empty = yes
        [/split]
    [/set_variables]
    [set_variables]
        name = SCHED_Y
        [split]
            list = {{SCHEDULE_Y}}
            key = val
            separator = ,
            remove_empty = yes
        [/split]
    [/set_variables]
    [set_variables]
        name = SCHED_P
        [split]
            list = {{SCHEDULE_Player}}
            key = val
            separator = ,
            remove_empty = yes
        [/split]
    [/set_variables]
    [set_variables]
        name = SCHED_B
        [split]
            list = {{SCHEDULE_isBan}}
            key = val
            separator = ,
            remove_empty = yes
        [/split]
    [/set_variables]
    [set_variables]
        name = PHASE_STR_ARR
        [split]
            list = {{PHASE_STRINGS}}
            key = val
            separator = ,
            remove_empty = yes
        [/split]
    [/set_variables]

    [if]
        {VARIABLE_CONDITIONAL SCHED_X.length not_equals $SCHED_Y.length}
        [or]
            {VARIABLE_CONDITIONAL SCHED_Y.length not_equals $SCHED_P.length}
            [or]
                {VARIABLE_CONDITIONAL SCHED_P.length not_equals $SCHED_B.length}
            [/or]
        [/or]
        [then]
            {DEBUG_MSG "Schedule Lists Mismatch!"}
        [/then]
    [/if]

    {VARIABLE TOTAL_PICKS 0}
    {FOREACH SCHED_P i}
        [if]
            {VARIABLE_CONDITIONAL SCHED_P[$i].val equals 1}
            {VARIABLE_CONDITIONAL SCHED_B[$i].val boolean_equals false}
            [then]
                {VARIABLE_OP TOTAL_PICKS add 1}
            [/then]
        [/if]
    {NEXT i}

    {DRAW_LIST}
#enddef

#define CREEP_SIDE_TURN
        [modify_side]
            side = 1,2,3,4,5,6,7,8
            gold = 100
        [/modify_side]
        {DRAW_LIST}
        {IF_VAR PICK_CTR greater_than_equal_to $SCHED_P.length (
            [then] #we only end the scenario after player 1 has had a chance to pass.
                [set_recruit]
                    recruit = ""
                    side = 1,2,3,4,5,6,7,8
                [/set_recruit]

                [event]
                    name = side 1 turn
                    [print]
                        text = "GAME WILL BEGIN"
                        size=20
                        duration=750
                        red,green,blue=255,0,0
                    [/print]
                    {CREEP_ISSUE_END_LEVEL}
                [/event]

                [event]
                    name = side 2 turn
                    [print]
                        text = "GAME HAS BEGUN???"
                        size=20
                        duration=750
                        red,green,blue=255,0,0
                    [/print]
                [/event]
            [/then]
            [else]
                {IF_VAR SCHED_P[$PICK_CTR].val not_equals $side_number (
                    [then]
                        [end_turn]
                        [/end_turn]
                    [/then]
                    [else]
                        {IF_VAR TEAM_W[$side_number].val boolean_equals yes (
                            [then]
                                {VARIABLE temp_x {W_GUARD_X}}
                                {VARIABLE temp_y {W_GUARD_Y}}
                            [/then]
                            [else]
                                {VARIABLE temp_x {E_GUARD_X}}
                                {VARIABLE temp_y {E_GUARD_Y}}
                            [/else]
                        )}
                        [modify_unit]
                            [filter] 
                                x = $temp_x
                                y = $temp_y
                            [/filter]
                            side = $side_number
                        [/modify_unit]
                        {VARIABLE NOTIFICATION ("P" + $SCHED_P[$PICK_CTR].val)}
                        {IF_VAR SCHED_B[$PICK_CTR].val boolean_equals yes (
                            [then]
                                {VARIABLE NOTIFICATION ($NOTIFICATION + " BAN")}
                            [/then]
                            [else]
                                {VARIABLE NOTIFICATION ($NOTIFICATION + " PICK")}
                            [/else]
                        )}
                        [print]
                            text = $NOTIFICATION
                            size=20
                            duration=750
                            red,green,blue=255,0,0
                        [/print]
                    [/else]
                )}
            [/else]
        )}        
#enddef

#define SWAP_LEADER i
            [store_unit] 
                [filter] 
                    side = {i}
                [/filter]
                kill = yes
                variable = temp
            [/store_unit]
            [unit]
                to_variable = newleader
                type = $temp[0].type
                id = $leader{i}.id
                side = $leader{i}.side
                generate_name = no
                name = $leader{i}.name
                canrecruit = yes
                random_traits = no
                gender = $leader{i}.gender
                x = $leader{i}.x
                y = $leader{i}.y
            [/unit]

            [unstore_unit]
                variable = newleader
                animate = no
            [/unstore_unit]
#enddef



#define CREEP_ISSUE_END_LEVEL
    [event]
        name = side turn end

        #make sure that none of the banned or other units end up on recall list!
        [kill]
            y = 8
        [/kill]
        [kill]
            x = {MOD_X}
        [/kill]

        {SWAP_LEADER 1}
        {SWAP_LEADER 2}
        {SWAP_LEADER 3}
        {SWAP_LEADER 5}
        {SWAP_LEADER 6}
        {SWAP_LEADER 7}
       
        {CLEAR_VARIABLE (SCHED_X, SCHED_Y, SCHED_P, SCHED_B, PHASE_STR_ARR, PICK_CTR, numpicked1, numpicked2, numpicked3, numpicked5, numpicked6, numpicked7, PICKS, picked_type, TOTAL_PICKS)}

        [endlevel]
            result=victory
            next_scenario=$next_scen

            carryover_percentage=0
            carryover_report=false
            carryover_add=false

            linger_mode=false
            save=no
            replay_save=no
        [/endlevel]
    [/event]
#enddef

#define create_CW_Guard_new team number x y side
	[unit]
		type=Lieutenant
		id=CW_Guard_{team}{number}
		name=Guard
		side={side}
		x={x}
		y={y}
		random_traits=no
		canrecruit=no
		[modifications]
			[object]
				[effect] 
					apply_to=hitpoints 
					increase_total=10
					heal_full=yes
				[/effect]
				[effect] 
					apply_to=attack
					range=melee
					increase_damage=-3
					increase_attacks=1
				[/effect]
				[effect]
					apply_to=attack
					range=ranged
					increase_damage=0
					increase_attacks=1
				[/effect]
				[effect]
					apply_to=max_experience
					increase=99920
				[/effect]
				[effect]
					apply_to=movement
					set=0
				[/effect]
				[effect]
					apply_to=resistance
					replace=true
					[resistance]
						blade=100
						cold=100
						fire=100
						impact=100
						pierce=100
						arcane=100
					[/resistance]
				[/effect]
			[/object]
		[/modifications]
		to_variable=guard_var
	[/unit]
	[set_variable]
		name=guard_var.alignment
		value=neutral
	[/set_variable]
	[unstore_unit]
		variable=guard_var
	[/unstore_unit]
#enddef


#define STORE_LEADER N
        [store_unit]
            [filter]
                side= {N}
                canrecruit = yes
            [/filter]
            variable = leader{N}
            kill = yes
        [/store_unit]
#enddef

#define DRAFT_SCEN ID NAME MAP_DATA NEXT_SCEN
[multiplayer]
    id={ID}
    name={NAME}
    description = _ "Draft a Creep War Team"
    objectives = _"You will now draft your creep war team. Each player will BAN and then PICK one unit. 

To SELECT a unit, simply RECRUIT it.

You may not pick a unit which has already been picked or banned."
    experience_modifier=60
    map_data="{MAP_DATA}"
    random_start_time=no
    victory_when_enemies_defeated=false

    {DUSK}
    {DEFAULT_MUSIC_PLAYLIST}

    [event]
        name = prestart
        {CREEP_PRESTART CREEP_6_SCHEDULE_Player CREEP_6_SCHEDULE_isBan CREEP_6_SCHEDULE_X CREEP_6_SCHEDULE_Y CREEP_6_STRINGS}

        {VARIABLE next_scen {NEXT_SCEN}}        

        {STORE_LEADER 1}
        {STORE_LEADER 2}
        {STORE_LEADER 3}
        {STORE_LEADER 5}
        {STORE_LEADER 6}
        {STORE_LEADER 7}

        {create_CW_Guard_new W 1 {W_GUARD_X} {W_GUARD_Y} {W_GUARD_TEAM}}
        {create_CW_Guard_new E 1 {E_GUARD_X} {E_GUARD_Y} {E_GUARD_TEAM}}
        [modify_unit]
            [filter]
                y = {W_GUARD_Y}
            [/filter]
            canrecruit = yes
        [/modify_unit]   

    [/event]
    [event]
        name=start
        [message]
            caption = _"Draft your creep war team!"
            image="portraits/humans/transparent/general.png"
            message =_  "Each player will get to BAN one unit and PICK one unit. 
You may not pick a unit which has been banned or already picked. 
To select, RECRUIT the desired unit on your turn."
        [/message]

        [label]
            x = 8
            y = 2
            text = "PICKS"
        [/label]
        [label]
            x = 8
            y = 8
            text = "BANS"
        [/label]
    [/event]
    [event]
        name = recruit
        first_time_only = no

        {CAPTAINS_RECRUIT_DEFAULT}
        [modify_unit]
            [filter]
                x = {W_GUARD_X}
                y = {W_GUARD_Y}
            [/filter]
            side = {W_GUARD_TEAM}
        [/modify_unit]
        [modify_unit]
            [filter]
                x = {E_GUARD_X}
                y = {E_GUARD_Y}
            [/filter]
            side = {E_GUARD_TEAM}
        [/modify_unit]
    [/event]
    [event]
        name = side turn
        first_time_only = no
        {CREEP_SIDE_TURN}
    [/event]

	[side]
                id = CW1
                persistent = yes
                save_id = CW1
		description=West Player 1
		side=1
		team_name=West
		canrecruit=yes
		controller=human
		gold=100
		income=-2
		team_lock=yes
		gold_lock=yes
		income_lock=yes
		share_view=yes
	[/side]
	[side]
                id = CW2
                persistent = yes
                save_id = CW2
		description=East Player 1
		side=2
		team_name=East
		canrecruit=yes
		controller=human
		gold=100
		income=-2
		team_lock=yes
		gold_lock=yes
		income_lock=yes
		share_view=yes
	[/side]
	[side]
                id = CW3
                persistent = yes
                save_id = CW3
		description=West Player 2
		side=3
		team_name=West
		canrecruit=yes
		controller=human
		gold=100
		income=-2
		team_lock=yes
		gold_lock=yes
		income_lock=yes
		share_view=yes
	[/side]
	[side]
		description=East Computer
		side=4
		team_name=East
		controller=ai
                persistent = no
		gold=100
		income=-2
		allow_player=no
                no_leader = yes
		team_lock=yes
		gold_lock=yes
		income_lock=yes
		share_view=yes
		canrecruit=yes
		[ai]
			aggression=0.9
			leader_value=3.0
			caution=0.0
			village_value=0.0
			[avoid]
				x=8,8,28,28,11,11,11,11,25,25,25,25
				y=9,11,9,11,9,10,11,12,9,10,11,12
			[/avoid]
#			version=10710
#			[stage]
#				engine=fai
#				name=unit_formulas
#			[/stage]
		[/ai]
	[/side]
	[side]
                id = CW5
                persistent = yes
                save_id = CW5
		description=East Player 2
		side=5
		team_name=East
		canrecruit=yes
		controller=human
		gold=100
		income=-2
		team_lock=yes
		gold_lock=yes
		income_lock=yes
		share_view=yes
	[/side]
	[side]
                id = CW6
                persistent = yes
                save_id = CW6
		description=West Player 3
		side=6
		team_name=West
		canrecruit=yes
		controller=human
		gold=100
		income=-2
		team_lock=yes
		gold_lock=yes
		income_lock=yes
		share_view=yes
	[/side]
	[side]
                id = CW7
                persistent = yes
                save_id = CW7
		description=East Player 3
		side=7
		team_name=East
		canrecruit=yes
		controller=human
		gold=100
		income=-2
		team_lock=yes
		gold_lock=yes
		income_lock=yes
		share_view=yes
	[/side]
	[side]
		description=West Computer
		side=8
		team_name=West
		controller=ai
                persistent=no
		gold=100
		income=-2
		allow_player=no
                no_leader = yes
		team_lock=yes
		gold_lock=yes
		income_lock=yes
		share_view=yes
		canrecruit=yes
		[ai]
			aggression=0.9
			leader_value=3.0
			caution=0.0
			village_value=0.0
			[avoid]
				x=8,8,28,28,11,11,11,11,25,25,25,25
				y=9,11,9,11,9,10,11,12,9,10,11,12
			[/avoid]
#			version=10710
#			[stage]
#				engine=fai
#				name=unit_formulas
#			[/stage]
#			[goal]
#				name=target_location
#				[criteria]
#					x,y=26,6
#				[/criteria]
#				value=20
#			[/goal]
		[/ai]
	[/side]
[/multiplayer]
#enddef

{DRAFT_SCEN multiplayer_Creep_War_Draft_Mode (_ "6p - Creep War Draft Mode") ({~add-ons/Creep_War/maps/creep_6p.map}) ("Creep War Draft Target")}
{DRAFT_SCEN multiplayer_Creep_War_Alternative_Draft_Mode (_ "6p - Creep War Alternate Draft Mode") ({~add-ons/Creep_War/maps/creep_6p_alternate.map}) ("Creep War Alternate Draft Target")}
